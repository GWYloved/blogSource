---
title: multidex错误小结
date: 2018-03-19 11:49:44
tags: android
---

最近项目中遇到一个问题，是关于multidex的。

multidex是android提供的一个分包工具，将原来的一个dex分为一个主dex入口和很多子dex，然后让虚拟机进行加载。

谷歌在L版本之前使用的dalvik虚拟机，这个虚拟机有一个坏处，他加载dex原本只设计了一个加载方式，就是只加载查询dex的第一个dex，因此假如使用了multidex分包策略时，必须设置编译的时候将什么放在主dex中，否则代码量一大，必然出现notfound，notdefined之类的找不到未命名未初始化的错误。

L之后使用了art虚拟机，就不再有这方面的问题。

这个问题很严重，导致了公司软件在android l以下的手机debug的时候打不开。

后来发现了一个神奇的事情。debug的时候，混淆开关是关着的，release的时候，混淆开关是开着的。结果release的版本可以顺利运行。

事实证明，虽然dalvik仍然只是加载一个主dex，这个主dex除了项目搭建的时候每个类都做了细致的标明，否则的确会出问题，但是若使用混淆，通过映射的方式，将代码映射开来，这样就有效避免了这个问题。

因此在android 5.0以下的手机需要分包，可以使用该方法。
