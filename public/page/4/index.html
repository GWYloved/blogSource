<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="记录者">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="记录者">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="记录者">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/4/"/>





  <title>记录者</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?6501f9771a3fc3833381947e71bdd393";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">记录者</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">我们坚持一件事情，并不是因为这样做了会有效果，而是坚信，这样做是对的。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/03/android事件分发机制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sample">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记录者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/03/android事件分发机制/" itemprop="url">android事件分发机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-03T23:10:07+08:00">
                2018-01-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/03/android事件分发机制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/03/android事件分发机制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>假如一个button<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">button.setOnClickListener(new OnClickListener()&#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void onClick(View v)&#123;</span><br><span class="line">		Log.d(&quot;TAG&quot;,&quot;onClick execute&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>同时设置ontouch事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">button.setOnTouchListener(new OnTouchListener()&#123;</span><br><span class="line">	@Override</span><br><span class="line">	public boolean onTouch(View v, MotionEvent event)&#123;</span><br><span class="line">		Log.d(&quot;TAG&quot;,&quot;onTouch execute, action &quot;+ event.getAction());</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>点击按钮log如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onTouch execute, action 0</span><br><span class="line">onTouch execute, action 1</span><br><span class="line">onClick execute</span><br></pre></td></tr></table></figure></p>
<p>onTouch是优先于onClick执行的，并且onTouch执行了2次，一次是ACTION_DOWN,一次是ACTION_UP。<br>顺序是先经过onTouch，在传递到onClick。</p>
<p>将ontouch返回值改为true，在运行一次，会发现onClick不再执行，这就是拦截了。</p>
<h1 id="dispatchTouchEvent"><a href="#dispatchTouchEvent" class="headerlink" title="dispatchTouchEvent"></a>dispatchTouchEvent</h1><p>任何view被触摸，一定会执行dispatchTouchEvent这个方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public boolean dispatchTouchEvent(MotionEvent event) &#123;  </span><br><span class="line">    if (mOnTouchListener != null &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp;  </span><br><span class="line">            mOnTouchListener.onTouch(this, event)) &#123;  </span><br><span class="line">        return true;  </span><br><span class="line">    &#125;  </span><br><span class="line">    return onTouchEvent(event);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码很明显的指出了，首先会执行的是set的onTouchListener的onTouch事件，之后才会执行自身的onTouchEvent事件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">public boolean onTouchEvent(MotionEvent event) &#123;  </span><br><span class="line">    final int viewFlags = mViewFlags;  </span><br><span class="line">    if ((viewFlags &amp; ENABLED_MASK) == DISABLED) &#123;  </span><br><span class="line">        // A disabled view that is clickable still consumes the touch  </span><br><span class="line">        // events, it just doesn&apos;t respond to them.  </span><br><span class="line">        return (((viewFlags &amp; CLICKABLE) == CLICKABLE ||  </span><br><span class="line">                (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE));  </span><br><span class="line">    &#125;  </span><br><span class="line">    if (mTouchDelegate != null) &#123;  </span><br><span class="line">        if (mTouchDelegate.onTouchEvent(event)) &#123;  </span><br><span class="line">            return true;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    if (((viewFlags &amp; CLICKABLE) == CLICKABLE ||  </span><br><span class="line">            (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)) &#123;  </span><br><span class="line">        switch (event.getAction()) &#123;  </span><br><span class="line">            case MotionEvent.ACTION_UP:  </span><br><span class="line">                boolean prepressed = (mPrivateFlags &amp; PREPRESSED) != 0;  </span><br><span class="line">                if ((mPrivateFlags &amp; PRESSED) != 0 || prepressed) &#123;  </span><br><span class="line">                    // take focus if we don&apos;t have it already and we should in  </span><br><span class="line">                    // touch mode.  </span><br><span class="line">                    boolean focusTaken = false;  </span><br><span class="line">                    if (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) &#123;  </span><br><span class="line">                        focusTaken = requestFocus();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    if (!mHasPerformedLongPress) &#123;  </span><br><span class="line">                        // This is a tap, so remove the longpress check  </span><br><span class="line">                        removeLongPressCallback();  </span><br><span class="line">                        // Only perform take click actions if we were in the pressed state  </span><br><span class="line">                        if (!focusTaken) &#123;  </span><br><span class="line">                            // Use a Runnable and post this rather than calling  </span><br><span class="line">                            // performClick directly. This lets other visual state  </span><br><span class="line">                            // of the view update before click actions start.  </span><br><span class="line">                            if (mPerformClick == null) &#123;  </span><br><span class="line">                                mPerformClick = new PerformClick();  </span><br><span class="line">                            &#125;  </span><br><span class="line">                            if (!post(mPerformClick)) &#123;  </span><br><span class="line">                                performClick();  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    if (mUnsetPressedState == null) &#123;  </span><br><span class="line">                        mUnsetPressedState = new UnsetPressedState();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    if (prepressed) &#123;  </span><br><span class="line">                        mPrivateFlags |= PRESSED;  </span><br><span class="line">                        refreshDrawableState();  </span><br><span class="line">                        postDelayed(mUnsetPressedState,  </span><br><span class="line">                                ViewConfiguration.getPressedStateDuration());  </span><br><span class="line">                    &#125; else if (!post(mUnsetPressedState)) &#123;  </span><br><span class="line">                        // If the post failed, unpress right now  </span><br><span class="line">                        mUnsetPressedState.run();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    removeTapCallback();  </span><br><span class="line">                &#125;  </span><br><span class="line">                break;  </span><br><span class="line">            case MotionEvent.ACTION_DOWN:  </span><br><span class="line">                if (mPendingCheckForTap == null) &#123;  </span><br><span class="line">                    mPendingCheckForTap = new CheckForTap();  </span><br><span class="line">                &#125;  </span><br><span class="line">                mPrivateFlags |= PREPRESSED;  </span><br><span class="line">                mHasPerformedLongPress = false;  </span><br><span class="line">                postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout());  </span><br><span class="line">                break;  </span><br><span class="line">            case MotionEvent.ACTION_CANCEL:  </span><br><span class="line">                mPrivateFlags &amp;= ~PRESSED;  </span><br><span class="line">                refreshDrawableState();  </span><br><span class="line">                removeTapCallback();  </span><br><span class="line">                break;  </span><br><span class="line">            case MotionEvent.ACTION_MOVE:  </span><br><span class="line">                final int x = (int) event.getX();  </span><br><span class="line">                final int y = (int) event.getY();  </span><br><span class="line">                // Be lenient about moving outside of buttons  </span><br><span class="line">                int slop = mTouchSlop;  </span><br><span class="line">                if ((x &lt; 0 - slop) || (x &gt;= getWidth() + slop) ||  </span><br><span class="line">                        (y &lt; 0 - slop) || (y &gt;= getHeight() + slop)) &#123;  </span><br><span class="line">                    // Outside button  </span><br><span class="line">                    removeTapCallback();  </span><br><span class="line">                    if ((mPrivateFlags &amp; PRESSED) != 0) &#123;  </span><br><span class="line">                        // Remove any future long press/tap checks  </span><br><span class="line">                        removeLongPressCallback();  </span><br><span class="line">                        // Need to switch from pressed to not pressed  </span><br><span class="line">                        mPrivateFlags &amp;= ~PRESSED;  </span><br><span class="line">                        refreshDrawableState();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">                break;  </span><br><span class="line">        &#125;  </span><br><span class="line">        return true;  </span><br><span class="line">    &#125;  </span><br><span class="line">    return false;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当事件为MotionEvent.ACTION_UP时，如果该控件可点击，会执行performClick()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public boolean performClick() &#123;  </span><br><span class="line">    sendAccessibilityEvent(AccessibilityEvent.TYPE_VIEW_CLICKED);  </span><br><span class="line">    if (mOnClickListener != null) &#123;  </span><br><span class="line">        playSoundEffect(SoundEffectConstants.CLICK);  </span><br><span class="line">        mOnClickListener.onClick(this);  </span><br><span class="line">        return true;  </span><br><span class="line">    &#125;  </span><br><span class="line">    return false;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从源码可以看出，基本上每一次事件，都会return 一个true，也就是消耗掉这次事件了。而之后的事件会重新进入，这也和之前的截断事件机制符合。</p>
<h1 id="onTouch和onTouchEvent有什么区别，又该如何使用？"><a href="#onTouch和onTouchEvent有什么区别，又该如何使用？" class="headerlink" title="onTouch和onTouchEvent有什么区别，又该如何使用？"></a>onTouch和onTouchEvent有什么区别，又该如何使用？</h1><p>从源码中可以看出，这两个方法都是在View的dispatchTouchEvent中调用的，onTouch优先于onTouchEvent执行。如果在onTouch方法中通过返回true将事件消费掉，onTouchEvent将不会再执行。<br>另外需要注意的是，onTouch能够得到执行需要两个前提条件，第一mOnTouchListener的值不能为空，第二当前点击的控件必须是enable的。因此如果你有一个控件是非enable的，那么给它注册onTouch事件将永远得不到执行。对于这一类控件，如果我们想要监听它的touch事件，就必须通过在该控件中重写onTouchEvent方法来实现。</p>
<h1 id="为什么给ListView引入了一个滑动菜单的功能，ListView就不能滚动了？"><a href="#为什么给ListView引入了一个滑动菜单的功能，ListView就不能滚动了？" class="headerlink" title="为什么给ListView引入了一个滑动菜单的功能，ListView就不能滚动了？"></a>为什么给ListView引入了一个滑动菜单的功能，ListView就不能滚动了？</h1><p>比如说左右滑的时候，还是正常的左右滑。<br>但是上下滑的时候，会出现一个问题，就是listview无法上下滑动，这主要是事件被scrollview给消耗掉了，需要在触摸的时候，scrollview不进行截断操作，让事件能够传递下去。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/03/android事件拦截机制分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sample">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记录者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/03/android事件拦截机制分析/" itemprop="url">android事件拦截机制分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-03T19:04:36+08:00">
                2018-01-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/03/android事件拦截机制分析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/03/android事件拦截机制分析/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>由于Android是树状结构，嵌套会导致事件发生区域重叠，针对重叠区域的处理，就叫事件拦截机制。</p>
<p>我们现在假设有一个嵌套结构</p>
<p>第一层： a-ViewGroup<br>第二层： b-ViewGroup<br>第三层： c-View</p>
<p>重写viewgroup的三个方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean dispatchTouchEvent(MotionEvent ev)&#123;</span><br><span class="line">	LogUtil.i(name+&quot;dispatch&quot;);</span><br><span class="line">	return super.dispatchTouchEvent(ev);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean onInterceptTouchEvent(MotionEvent ev)&#123;</span><br><span class="line">	LogUtil.i(name+&quot;intecept&quot;);</span><br><span class="line">	return super.onInterceptTouchEvent(ev);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean onTouchEvent(MotionEvent ev)&#123;</span><br><span class="line">	LogUtil.i(name+&quot;onTouch&quot;);</span><br><span class="line">	return super.onTouchEvent(ev);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于view不需要重写onInterceptTouchEvent,只需要重写另外的两个事件即可。</p>
<h1 id="点击c-–正常情况"><a href="#点击c-–正常情况" class="headerlink" title="点击c –正常情况"></a>点击c –正常情况</h1><p>Log显示为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a dispatch</span><br><span class="line">a intercept</span><br><span class="line">b dispatch</span><br><span class="line">b intercept</span><br><span class="line">c dispatch</span><br><span class="line">c ontouch</span><br><span class="line">b ontouch</span><br><span class="line">a ontouch</span><br></pre></td></tr></table></figure></p>
<p>事件的传递顺序为a-&gt;b-&gt;c， 事件传递的时候是先执行dispatchTouchEvent()方法，之后在执行onInterceptTouchEvent()方法。<br>事件处理的顺序为c-&gt;b-&gt;a</p>
<p>事件传递的返回值很容易理解：True,拦截，不继续;False,不拦截，继续流程。<br>事件处理的返回值也类似：True,处理了，不用审核了;False,给上级处理。</p>
<p>初始情况下，返回值都是false。</p>
<h1 id="让a的onInterceptTouchEvent-返回true"><a href="#让a的onInterceptTouchEvent-返回true" class="headerlink" title="让a的onInterceptTouchEvent()返回true"></a>让a的onInterceptTouchEvent()返回true</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a dispatch</span><br><span class="line">a intercept</span><br><span class="line">a ontouch</span><br></pre></td></tr></table></figure>
<p>很明显是a处截断了。</p>
<h1 id="让b的onInterceptTouchEvent-返回true"><a href="#让b的onInterceptTouchEvent-返回true" class="headerlink" title="让b的onInterceptTouchEvent()返回true"></a>让b的onInterceptTouchEvent()返回true</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a dispatch</span><br><span class="line">a intercept</span><br><span class="line">b dispatch</span><br><span class="line">b intercept</span><br><span class="line">b ontouch</span><br><span class="line">a ontouch</span><br></pre></td></tr></table></figure>
<p>很明显是b处截断了。</p>
<h1 id="让c的onInterceptTouchEvent-返回true"><a href="#让c的onInterceptTouchEvent-返回true" class="headerlink" title="让c的onInterceptTouchEvent()返回true"></a>让c的onInterceptTouchEvent()返回true</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a dispatch</span><br><span class="line">a intercept</span><br><span class="line">b dispatch</span><br><span class="line">b intercept</span><br><span class="line">c dispatch</span><br><span class="line">c ontouch</span><br></pre></td></tr></table></figure>
<p>解释一下ontouchevent为true的意义。<br>假如ontouchevent为false，代表这个ontouch事件没有结束，因此还会继续找别的事件来进行处理直到返回的ontouchevent为true。有一些view自己写了默认的ontouch事件，因此假如想继承一个有功能的view而又不想它产生ontouch效果，可以返回true来截断默认的ontouch事件。<br>一般情况下false可以起到添加额外效果的功能。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/03/android持久化存储/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sample">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记录者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/03/android持久化存储/" itemprop="url">android持久化存储</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-03T14:57:26+08:00">
                2018-01-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/03/android持久化存储/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/03/android持久化存储/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="内部存储（internalStorage）"><a href="#内部存储（internalStorage）" class="headerlink" title="内部存储（internalStorage）"></a>内部存储（internalStorage）</h1><p>data文件夹就是我们常说的内部存储，其中有两个文件夹需要关注，一个是app文件夹，一个是data文件夹。</p>
<h2 id="app文件夹"><a href="#app文件夹" class="headerlink" title="app文件夹"></a>app文件夹</h2><p>app文件夹里存放着我们所有安装的app的apk文件。</p>
<h2 id="data文件夹"><a href="#data文件夹" class="headerlink" title="data文件夹"></a>data文件夹</h2><p>这个文件夹里面都是一些包名，打开这些包名会看到：</p>
<ol>
<li>data/data/包名/shared_prefs</li>
<li>data/data/包名/databases</li>
<li>data/data/包名/files</li>
<li>data/data/包名/cache</li>
</ol>
<p>sharedPreferenced的时候，数据持久化存储于本地，其实就是存在这个文件中的xml文件里面。<br>数据库文件就是存储于databases文件夹中。<br>普通数据存储在files中。<br>缓存文件存储在cache文件夹中。</p>
<h1 id="外部存储（externalStorage）"><a href="#外部存储（externalStorage）" class="headerlink" title="外部存储（externalStorage）"></a>外部存储（externalStorage）</h1><p>外部存储是我们平时操作最多的，外部存储一般就是我们看到的storage文件夹，当然也有mnt文件夹，不同厂家有可能不一样。<br>一般来讲storage文件夹中有一个sdcard文件夹，这个文件夹中的文件又分为两类，一类是公有目录，一类是私有目录。公有目录又分为九大类，比如说DCIM、DOWNLOAD等这种系统为我们创建的文件夹。私有目录就是android这种文件夹，这个文件夹打开之后里面有一个data文件夹，打开这个data文件夹，里面有许多包名组成的文件夹。</p>
<h1 id="存储操作"><a href="#存储操作" class="headerlink" title="存储操作"></a>存储操作</h1><h2 id="文件存储"><a href="#文件存储" class="headerlink" title="文件存储"></a>文件存储</h2><p>文件存储的所有文件默认放在/data/data/<packagename>/file/目录下</packagename></p>
<h3 id="文件写入"><a href="#文件写入" class="headerlink" title="文件写入"></a>文件写入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public void save(String inputText)&#123;</span><br><span class="line">	FIleOutputStream out = null;</span><br><span class="line">	BufferedWriter writer = null;</span><br><span class="line">	try&#123;</span><br><span class="line">		out = openFileOutput(&quot;data&quot;, Context.MODE_PRIVATE);</span><br><span class="line">		writer = new BufferedWriter(new OutputStreamWriter(out));</span><br><span class="line">		writer.write(inputText);</span><br><span class="line">	&#125;catch(FileNotFoundException e)&#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;catch(IOException e)&#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;finally&#123;</span><br><span class="line">		if(writer != null)&#123;</span><br><span class="line">			try&#123;</span><br><span class="line">				writer.close();</span><br><span class="line">			&#125;catch(IOException e)&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public String load()&#123;</span><br><span class="line">	FileInputStream in = null;</span><br><span class="line">	BufferedReader reader = null;</span><br><span class="line">	StringBuilder content = new StringBuilder();</span><br><span class="line">	try&#123;</span><br><span class="line">		in = openFileInput(&quot;data&quot;);</span><br><span class="line">		reader = new BufferedReader(new InputStreamReader(in));</span><br><span class="line">		String line = &quot;&quot;;</span><br><span class="line">		while((line = reader.readLine()) != null)&#123;</span><br><span class="line">			content.append(line);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;catch(FileNotFoundException e)&#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;catch(IOException e)&#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;finally&#123;</span><br><span class="line">		if(reader != null)&#123;</span><br><span class="line">			try&#123;</span><br><span class="line">				reader.close();</span><br><span class="line">			&#125;catch(IOException e)&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return content.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SharePreferences"><a href="#SharePreferences" class="headerlink" title="SharePreferences"></a>SharePreferences</h2><p>Sharepreference默认放在/data/data/<packagename>/file/目录下</packagename></p>
<h3 id="SharedPreferences写入"><a href="#SharedPreferences写入" class="headerlink" title="SharedPreferences写入"></a>SharedPreferences写入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SharedPreferences.Editor editor = getSharedPreferences(&quot;data&quot;, MODE_PRIVATE).edit();</span><br><span class="line">editor.putString(&quot;et_inputText&quot;, &quot;sharePreferences test&quot;);</span><br><span class="line">editor.commit();</span><br></pre></td></tr></table></figure>
<h3 id="SharedPreferences读取"><a href="#SharedPreferences读取" class="headerlink" title="SharedPreferences读取"></a>SharedPreferences读取</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SharedPreferences sp = getSharedPreferences(&quot;data&quot;, MODE_PRIVATE);</span><br><span class="line">String input = sp.getString(&quot;et_inputText&quot;, &quot;请输入用户名&quot;);//第二个参数是为空的默认信息</span><br></pre></td></tr></table></figure>
<h2 id="SQLite数据库存储"><a href="#SQLite数据库存储" class="headerlink" title="SQLite数据库存储"></a>SQLite数据库存储</h2><p>sqlite文件默认放在/data/data/<packagename>/datanases/目录下</packagename></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class MyDataBaseHelper extends SQLiteOpenHelper&#123;</span><br><span class="line">	private static final String CREATE_BOOK = &quot;create table Book(id integer primary key autoincrement, author text, price real, pages integer, name text)&quot;;</span><br><span class="line">	private static final String CREATE_CATEGORY = &quot;create table Category(id integer primary key autoincrement, category_name text, category_code integer)&quot;;</span><br><span class="line">	private Context mContext;</span><br><span class="line">	public MyDataBaseHelper(Context context, String name, SQLiteDatabase.CursorFactory factory, int version)&#123;</span><br><span class="line">		super(context, name, factory, version);</span><br><span class="line">		mContext = context;</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	public void onCreate(SQLiteDatabase db)&#123;</span><br><span class="line">		db.execSQL(CREATE_BOOK);</span><br><span class="line">		db.execSQL(CREATE_CATEGORY);</span><br><span class="line">		Toast.makeText(mContext, &quot;create succeed&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion)&#123;</span><br><span class="line">		db.execSQL(&quot;drop table if exists Book&quot;);</span><br><span class="line">		db.execSQL(&quot;drop table if exists Category&quot;);</span><br><span class="line">		onCreate(db);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbHelper = new MyDataBaseHelper(this, &quot;BookStore.db&quot;, null, 2);</span><br></pre></td></tr></table></figure>
<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SQLiteDatabase db = dbHelper.getWritableDatabase();</span><br><span class="line">ContentValues values = new ContentValues();</span><br><span class="line">values.put(&quot;name&quot;, &quot;Effective Java&quot;);</span><br><span class="line">values.put(&quot;author&quot;, &quot;Joshua Bloch&quot;);</span><br><span class="line">values.put(&quot;pages&quot;, 454);</span><br><span class="line">values.put(&quot;price&quot;, 16.96);</span><br><span class="line">db.insert(&quot;Book&quot;, null, values);</span><br></pre></td></tr></table></figure>
<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ContentValues values = new ContentValues();</span><br><span class="line">values.put(&quot;price&quot;, 198.00);</span><br><span class="line">SQLiteDatabase db = dbHelper.getReadableDatabase();</span><br><span class="line">db.updata(&quot;Book&quot;, values, &quot;name=?&quot;,new String[]&#123;&apos;Android Programme&apos;&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="删除行"><a href="#删除行" class="headerlink" title="删除行"></a>删除行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQLiteDatabase db = dbHelper.getWritableDatabase();</span><br><span class="line">db.delete(&quot;Book&quot;, &quot;pages &gt; ?&quot;, new String[]&#123;&quot;500&quot;&#125;);</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/02/viewgroup测量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sample">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记录者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/02/viewgroup测量/" itemprop="url">viewgroup测量</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-02T23:07:40+08:00">
                2018-01-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/02/viewgroup测量/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/02/viewgroup测量/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ViewGroup会去管理子view，当ViewGroup的大小为wrap_content时，ViewGroup就需要对子View进行遍历，以便获得所有的子View的大小，从而决定自己的大小。在其他模式下则会通过具体的制定值来设置自身的大小。<br>ViewGroup在测量时通过遍历所有的子view，从而调用子view的measure方法来获得每个子view的测量结果。<br>当子view测量结束时，就会将子view放到合适的位置，这个过程就是子view的layout过程。viewgroup在执行layout过程时，也同样是使用遍历的方法来调用子view的layout方法，并指定其具体显示的位置，从而来决定其布局位置。<br>在自定义viewgroup中，通常会重写layout方法来控制子view显示位置的逻辑。同样如果是wrap_content，也必须重写onmeasure方法，这点与view是相同的。</p>
<h1 id="viewgroup的绘制"><a href="#viewgroup的绘制" class="headerlink" title="viewgroup的绘制"></a>viewgroup的绘制</h1><p>viewgroup通常不需要绘制，因为本身没有什么值得绘制的东西，如果不是需要指定viewgroup的颜色，甚至连ondraw方法都不会调用。但是viewgroup会使用dispatchDraw()方法来绘制子view</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/02/view的测量和绘制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sample">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记录者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/02/view的测量和绘制/" itemprop="url">view的测量和绘制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-02T12:38:03+08:00">
                2018-01-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/02/view的测量和绘制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/02/view的测量和绘制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>系统绘制一个view，如同蒙着眼睛的小孩拿着笔在画板上画出一个指定的图案。因此需要一个人在旁边指导他如何去画。<br>Android就是那个蒙着眼睛画画的人，开发者需要告诉它如何去画。</p>
<h1 id="View的测量"><a href="#View的测量" class="headerlink" title="View的测量"></a>View的测量</h1><p>去画一个图形，就必须知道它的大小和位置。<br>Android系统在绘制view之前，也必须对view进行测量，告诉系统该画一个多大的view。这个过程在onMeasure()中进行。</p>
<h2 id="MeasureSpec"><a href="#MeasureSpec" class="headerlink" title="MeasureSpec"></a>MeasureSpec</h2><p>measurespec是一个协助测量view的类。它是一个32位的int值，其中高2位为测量的模式，低30位为测量的大小。使用位运算是为了提高并优化效率。<br>测量的模式分为以下三种：</p>
<ol>
<li><p>EXACTLY<br>精确模式，当我们将控件的layout_width属性或者layout_height属性指定为具体数值时，比如android:layout_height=”100dp”,或者指定为match_parent属性时，系统使用的是EXACTLY模式。</p>
</li>
<li><p>AT_MOST<br>最大值模式，当控件的layout_width属性或者layout_height属性指定为wrap_content时，控件的大小一般随着子控件或内容的变化而变化，此时控件的尺寸只要不超过父控件的最大尺寸即可。</p>
</li>
<li><p>UNSPECIFIED<br>不指定大小测量模式。view想多大就多大，通常在绘制自定义view时才使用。</p>
</li>
</ol>
<p>View类默认的onMeasure()方法只能支持EXACTLY模式。如果要让自定义view支持wrap_content属性，必须重写onMeasure方法来指定wrap_content时的大小。</p>
<h2 id="测量的步骤"><a href="#测量的步骤" class="headerlink" title="测量的步骤"></a>测量的步骤</h2><ol>
<li>从MeasureSpec对象中提取具体的测量模式和大小</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int specMode = MeasureSpec.getMode(measureSpec);</span><br><span class="line">int specSize = MeasureSpec.getSize(measureSpec);</span><br></pre></td></tr></table></figure>
<ol>
<li>通过判断测量的模式，给出不同的判断值。当specMode为EXACTLY时，直接使用指定的specSize即可；当specMode为其他两种模式时，需要给它一个默认的大小。特别的，如果指定wrap_content属性，即AT_MOST模式，需要取出我们制定的大小与specSize中最小的一个来作为最后的测量值。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">private int measureWidth(int measureSpec)&#123;</span><br><span class="line">	int result = 0;</span><br><span class="line">	int specMode = MeasureSpec.getMode(measureSpec);</span><br><span class="line">	int specSize = MeasureSpec.getSize(measureSpec);</span><br><span class="line"></span><br><span class="line">	if(specMode == MeasureSpec.EXACTLY)&#123;</span><br><span class="line">		result = specSize;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		result = 200;</span><br><span class="line">		if(specMpde == MeasureSpec.AT_MOST)&#123;</span><br><span class="line">			result = Math.min(result, specSize);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/01/2018开年愿景/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sample">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记录者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/01/2018开年愿景/" itemprop="url">2018开年愿景</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-01T15:47:32+08:00">
                2018-01-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/01/2018开年愿景/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/01/2018开年愿景/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="凡事欲则立，不预则废"><a href="#凡事欲则立，不预则废" class="headerlink" title="凡事欲则立，不预则废"></a>凡事欲则立，不预则废</h1><p>在此2018年的开端，也是我人生的第25个年头开始之际，回顾一下2017年发生的事情，同时也为自己2018年的计划写下一个开端。<br>古话说的好，“凡事欲则立，不预则废”，万事开头难，难在一个完善完整理性的计划。凡事都可以量化，足够完美的量化计划，可以将事情完整的捋清，这样之后行动的时候便有一个完整的大纲，这也是此篇文章的初心。</p>
<h1 id="2017回顾"><a href="#2017回顾" class="headerlink" title="2017回顾"></a>2017回顾</h1><blockquote>
<p>人生在世，太多事情身不由己。在其位必谋其政，有所得，也必有所失。</p>
</blockquote>
<p>2016年毕业，2017是我进入社会的第二个年头。</p>
<h2 id="传音"><a href="#传音" class="headerlink" title="传音"></a>传音</h2><p>1月-6月，我仍然在传音工作，也是我技术的一个打磨期。这段时间对我的影响还是比较大的，包括并不局限于身体，三观，但我仍然会从这两方面来解析事情的发生。</p>
<p>首先是技术方面。由于此阶段，我仍然从事于android-framework-systemui部分，未接触app层开发，因此工作任务仍然是处理bug。此阶段处理了大量的statusbar,navigationbar,keyguard,recents,volume等部分的bug，熟练了bug处理的技术，能够及时快速的定位bug发生点然后进行规模测试复现等，之后进行补丁更改，这一阶段给我阅读代码的能力带来了很大的提升，但是问题也出现了。</p>
<h3 id="技术问题方面。"><a href="#技术问题方面。" class="headerlink" title="技术问题方面。"></a>技术问题方面。</h3><p>由于掌握的开发技术过少，经常遇到遇到bug问题，不知道如何高效正确的处理。换言之，仍然使用的是死方法，例如有一次遇到一个线程更新监听导致的ui刷新不及时问题，由于对线程的掌握不足，对监听器的使用不足，导致我修改策略竟然是在此处加一个固定延时，虽然解决了问题，但是明显是下下之策，造成了固定的性能浪费。我也因此被批评了一顿。这件事情的发生，给我之后决定转型下了一个决心。</p>
<h3 id="三观-世界观。"><a href="#三观-世界观。" class="headerlink" title="三观-世界观。"></a>三观-世界观。</h3><p>我曾经以为这个世界是黑暗的，但是在传音工作的时间，让我改变了很多。<br>首先是我的导师-韦灵春，作为传音导师制下我的导师，她对我的能力提升做了很大的努力。她教导我，应该如何去解决问题，对我的职业规划也进行了很多的指点。最感谢的，还是在我辞职之后，她对我的鼓励，给我很大的动力去解决当时的困境。导师于17年结婚了，祝福。<br>之后是我遇到的同事，瑞辰，莫通，宇杰，春孟，汪涵，德华，还有当时的老大，凯旋。大家都是年轻人，对我这么一个新人，都有很大的关照。在没有利益面前，大家其实都愿意对新人给予关怀的。之后小组更改，凯旋哥走了，来了新的老大，新的同事，我和新的老大没有什么沟通，不过新的同事倒是有交流。新同事叫权力，他也给我很多的指导。<br>在这么多人的指点下，我也成为了应届生当中较为出色的人。<br>人在这个世界上，终归不是孤独的，只要姿态不高调，事实上很多人会愿意给予帮助。将来我若是组建团队，或者面对新人的时候，也要尽量给予足够的帮助。让这份温暖能够流转下去。</p>
<h3 id="三观-价值观"><a href="#三观-价值观" class="headerlink" title="三观-价值观"></a>三观-价值观</h3><p>我曾经以为，每个公司的升职制度都是约定俗成的。当然在传音的这一阶段，完全摧毁了这个设想。<br>我们这一届，加薪的只有一个人。而且还是瞒着加薪的。也就是说，实际上给我们承诺的加薪，就是一句空话。<br>在传音的时候，我的工资转正之后，只有5400多的到手工资，当然，额外还有大约1000多的五险一金和根据加班时间来提供的大约540-840的补贴。<br>这份工资实在是摧毁了我的自信心。我原本从事程序这个行业，就是冲着高薪而去。但是这份到手甚至略低于上海平均工资的薪水，让我一时间自信心沮丧到极点。</p>
<blockquote>
<p>会叫的孩子有奶吃</p>
</blockquote>
<p>我一瞬间意识到了这句话的意义。</p>
<h3 id="三观-人生观"><a href="#三观-人生观" class="headerlink" title="三观-人生观"></a>三观-人生观</h3><p>在传音的时候我下了一个巨大的决心，买房子。</p>
<p>人生究竟是为了什么？</p>
<ol>
<li>家庭</li>
<li>事业</li>
<li>社会责任</li>
</ol>
<p>家庭的成立因素是什么？</p>
<ol>
<li>妻子</li>
<li>父母</li>
<li>子女</li>
</ol>
<p>妻子的满足因素是什么？</p>
<ol>
<li>女朋友</li>
<li>婚姻</li>
</ol>
<p>女朋友的满足因素是什么？</p>
<ol>
<li>人品</li>
<li>情商</li>
<li>房子/车子</li>
</ol>
<p>因此，房子是一个死路，是必须要走的路。<br>房子在哪儿买？这个问题思考了很久，原本决定是在南京，但是南京的房价实在是太贵了，当时估价一下，首付在30%，尚且需要大约80万的首付，同时之后需要每个月背负大约6000的房贷持续20年或者5000多持续30年。实在是一笔沉重的负担。<br>之后南京政府发布限购令，一瞬间把我在南京定居的想法给摧毁了，按照当时的市价，一年后的房价大约会涨30%，这就代表了总价大约70万的增长，首付大约需要多出20万。这是压死骆驼的最后一根稻草，何况当时我在上海工作，根本无法获得一年的南京的社保。<br>之后便思考回去购买，考虑了一圈，最后决定买在城北。城北一是靠家，二是靠近北车站，三是靠近宽广的马路，当然最重要的是，价格可以接受。<br>最后是首付25万加上商贷16万和公积金贷8万，便买下了第一个属于自己的房子，124平。<br>事实上现在也已经验证了我决定的重要性。在2月份，高铁尚且没有定论是否会落地大丰的时候，房价仍然处于动荡期，当时的价格可以4800左右一平。而在我购买之后，高铁落户大丰，房价一通猛涨，站在18年年初来看，算上了活动诱惑，仍然超过了6000一平。<br>这一个决定，站在如今的立场上，我少付出了156000+的总价，这是我2年能存下来的钱。<br>另外，由于月供只需要3700，这笔钱我如果拖到10年期，是获得利息甚至大于付出利息的。<br>之所以把这段话写在在传音的期间，是因为在传音导致的思虑决定的。当然，也因为过于孤独导致的思考，来决定的。<br>孤独是17年整年的格局。<br>工资低导致的自我怀疑，让我的性格产生了严重的变化。我失去了当时关系特别好的黄琦，很难过。之后人生便如同一条江的两条分流，从此再也没有可能汇合的可能。这是我17年最大的遗憾，也许会成为我人生的遗憾。<br>在传音的时间，我规划好了将来。当然是一个虚拟的规划。大致计划了一个五年。<br>16-18 技术沉淀 -24周岁<br>18-19 技术深化 -25周岁<br>19-21 自我事业 -27周岁<br>这个时间需要跟随着时间来不断细化，但是有个起步的计划，将来会少走很多弯路。</p>
<p>传音的段落告结，总而言之，虽然传音压榨了我的价值，但也同时锻炼了我的技术。仍然感恩。<br>在17年5月19日我提交了离职报告，并于6月19日离开了传音。</p>
<h2 id="崇杏"><a href="#崇杏" class="headerlink" title="崇杏"></a>崇杏</h2><p>原本接受了华勤通讯的offer，却由华勤单方面毁约，于是17年6月19日离职之后，我便参与了各大公司的面试，在电话面试了2家，正式面试了一家之后，顺利的拿到了两个offer，一个是崇杏，一个某博彩公司。最后<br>于17年6月27日顺利入职崇杏。<br>在崇杏我遇到了新的同事，新的老大，从事的也是和framework截然不同的app开发，薪资也总体提升了大约40%，到手直接接近翻倍。很开心，完成了我跳槽的愿望。<br>新公司的氛围就是放手去干，独立开发给我带来了技术上很大的进步，响应式，aop，mvp，等等，几个月学到了传音一年都没有学到的东西。<br>但是问题也很大，独立开发，我遇到的所有的问题，都需要自己解决。我的技术沉浸于一种“不了解就只能用死办法”的程度，没有人指点的情况下，技术其实是停滞不前的。<br>我缺少了信息获取的渠道，这是很致命的。我因此加入了android developer群，关注了技术社区，使用github进行技术搜索，虽然对最新技术能有一定的获取渠道了，但是新的问题就暴露出来了。<br>对新技术的学习需要长时间持久的投入，我很缺少耐心，长时间的专注力。<br>17年我开读了《概率论》，《算法导论》，《head first html》，《数据结构与算法（java实现）》，公务员公考系列书籍。无一例外，全部没有读完。<br>这个缺点是致命的，学习没有长久的投入，没有技术上面的厚积薄发，而浅尝辄止无疑会带来崩溃。</p>
<blockquote>
<p>一个人会n份初级开发技能，并不能带来n份初级开发工资</p>
</blockquote>
<p>这个问题暴露的很严重，对我将来的发展将有很大的干扰。</p>
<h2 id="反思总结"><a href="#反思总结" class="headerlink" title="反思总结"></a>反思总结</h2><p>17年可谓收获满满，整个人是顺利的变成了社会人。放弃了幻想，而拥抱了实际。</p>
<h3 id="问题暴露"><a href="#问题暴露" class="headerlink" title="问题暴露"></a>问题暴露</h3><h4 id="收入仍需提高"><a href="#收入仍需提高" class="headerlink" title="收入仍需提高"></a>收入仍需提高</h4><p>在目前阶段，这个收入尚且满足，但是若是战线拉开到五年计划之中，便不足够了。因此新的一年，仍然要密切把握赚钱的方面。</p>
<ol>
<li><p>工资提高<br>毋庸置疑，这是最直接的方法。但是我对崇信能否给我加薪抱有一种怀疑的态度，这个需要在第一季度总结里面来进行反馈。</p>
</li>
<li><p>理财投入<br>最近买的是支付宝的招行人寿理财，年化接近5%，新的一年需要继续开源，希望能够将一些钱进行分化投入。股市是我一直想进去而不敢进去的领域，新的一年我需要多和汝昌交流，了解这个领域，从而决定是否进行投入。</p>
</li>
<li><p>积蓄<br>节流是个很好的方法。在上海的消费较高，尤其是吃饭方面，若是每顿都在外面吃，馆子还好，若是外卖的话，是在是太贵，而且不够干净。<br>新的一年要在厨艺方面有些投入，最好伙食能够自给自足，这样能省很多的钱下来。<br>目前争取一个月固定开销，1200房租+200水电和公共投入+200的通行+400的额外支出。其余的节省下来用于别的地方。</p>
</li>
</ol>
<h4 id="学习需要抓紧"><a href="#学习需要抓紧" class="headerlink" title="学习需要抓紧"></a>学习需要抓紧</h4><ol>
<li><p>把握好地铁上的时间，每天早一小时，晚一小时，这些时间段用于阅读技术代码和学习新的语言。</p>
</li>
<li><p>晚上回来要保持一小时的学习时间，会很累，但是要戒掉斗鱼，戒掉不良的习惯。</p>
</li>
<li><p>周末时间不能过度用于浪费了，周末时间需要进行技术的实战。macbookpro已经买了，一定要用到实处。</p>
</li>
</ol>
<h4 id="身体健康"><a href="#身体健康" class="headerlink" title="身体健康"></a>身体健康</h4><ol>
<li><p>戒烟。</p>
</li>
<li><p>健身房一周去2-3次。</p>
</li>
<li><p>不能晚于23：00之前上床，23：30入睡。</p>
</li>
<li><p>每日早饭必须要吃</p>
</li>
<li><p>每日晚上19:00之后不可以在入食。</p>
</li>
</ol>
<h2 id="18年计划安排"><a href="#18年计划安排" class="headerlink" title="18年计划安排"></a>18年计划安排</h2><ol>
<li><p>阅读10本书，并做详细的读书笔记。<br>书单目前是：《Android群英传》《数据结构与算法（java）》《算法导论》《python核心卷2》《javascript dom编程艺术》《博弈论》《运筹学教程》《运筹学习题》。<br>暂定8本，酌情添加。</p>
</li>
<li><p>掌握一门新的语言。<br>暂定是俄语。能够达到会说简单口语的地步。</p>
</li>
<li><p>体重减轻到140。<br>这个一定要成功。</p>
</li>
<li><p>github每日更新。<br>可以把读书笔记放上去，最好是技术的锻炼。</p>
</li>
<li><p>戒烟/酒。</p>
</li>
</ol>
<h2 id="细分量化计划安排"><a href="#细分量化计划安排" class="headerlink" title="细分量化计划安排"></a>细分量化计划安排</h2><p>2018年，全年共365天，四个季度12个月共52周余一天。<br>每本书平均阅读5周，体重平均一周减一斤。抛去不可抗力，进行下列理想化安排。</p>
<h3 id="工作日"><a href="#工作日" class="headerlink" title="工作日"></a>工作日</h3><p>8:00起床-&gt;8:30洗漱完毕-&gt;8:50到地铁站:背一小时单词<br>12:00吃饭-&gt;12:20看书40分钟-&gt;13:00休息半小时<br>19:00下班-&gt;19:30到地铁站:学习一小时pdf版书籍<br>工作日周二和周四：<br>20:30出站-&gt;健身房力量锻炼15分钟+30分钟慢跑+洗澡-&gt;10:20回家-&gt;做饭20分钟-&gt;洗漱20分钟-&gt;上床<br>工作日1，3，5:<br>20:30出战-&gt;20:50回家-&gt;做饭20分钟-&gt;整理笔记一小时-&gt;洗漱20分钟-&gt;上床看书20分钟-&gt;睡觉</p>
<h3 id="节假日"><a href="#节假日" class="headerlink" title="节假日"></a>节假日</h3><p>8:00起床-&gt;8:30洗漱完毕-&gt;20分钟煮粥-&gt;吃完早饭9:00<br>看书2小时-&gt;11:00-&gt;做午饭20分钟吃午饭-&gt;11：40午休<br>12:30起床看书2小时-&gt;娱乐2小时-&gt;健身房力量锻炼30分钟+慢跑30分钟+洗澡-&gt;17:30回家<br>18:00做晚饭20分钟+吃饭-&gt;18:30读书1小时+整理笔记1小时-&gt;娱乐2小时-&gt;23:00上床睡觉</p>
<p>每一季度一次反馈，视成果和问题进行调整。同时记录不可抗力影响因素。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/31/ios-stanford-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sample">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记录者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/31/ios-stanford-1/" itemprop="url">ios-stanford-1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-31T21:44:56+08:00">
                2017-12-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/31/ios-stanford-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/31/ios-stanford-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="what‘s-in-iOS？"><a href="#what‘s-in-iOS？" class="headerlink" title="what‘s in iOS？"></a>what‘s in iOS？</h1><h2 id="Core-OS"><a href="#Core-OS" class="headerlink" title="Core OS:"></a>Core OS:</h2><p>iOS基本就是一个基于Unix的操作系统，它大量借鉴了Mac OS X的内核部分。<br>所以Core OS部分，包含了Sockets,Security,BSD,Mach 3.0,OSX Kernal, Power Management, Keychain Access, Certifications, File System Bonjour.这些实现一个操作系统的部分。</p>
<h2 id="Core-Services"><a href="#Core-Services" class="headerlink" title="Core Services:"></a>Core Services:</h2><p>这是一个能够让开发者使用大量的面向对象编程技术，但这层不包括ui，而是更多用于通过面向对象编程的方式访问硬件或者访问网络等等。我们需要耗费很多的时间，因为我们需要这些原始组件来建立更高的层。<br>包括了Collections,Address Book,Networking,FileAccess, SQLite, CoreLocation,Net Services, Threading, Preferences, URL Utilities.</p>
<h2 id="Media"><a href="#Media" class="headerlink" title="Media"></a>Media</h2><p>Core Audio, OpenAL, Audio Mixing, Audio Mixing, Audio Recording, Video Playback, JPEG/PNG/TIFF, PDF, Quartz(2D), Core Animation, OpenGL ES.</p>
<h2 id="Cocoa-Touch"><a href="#Cocoa-Touch" class="headerlink" title="Cocoa Touch"></a>Cocoa Touch</h2><p>Multi-Touch, Alerts, Core Motion, Web View, View Hierarchy, Map kit, Localization, Image Picker, Controls, Camera<br>使用这些与用户互动</p>
<h1 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h1><p>MVC是一种设计模式，更有利于阅读代码。而iOS从一开始就使用MVC设计，这是构建iOS的一种方法。</p>
<h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/23/爬虫相关/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sample">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记录者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/23/爬虫相关/" itemprop="url">爬虫相关</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-23T17:21:18+08:00">
                2017-12-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/23/爬虫相关/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/23/爬虫相关/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概念相关："><a href="#概念相关：" class="headerlink" title="概念相关："></a>概念相关：</h1><h2 id="所有网站皆可爬"><a href="#所有网站皆可爬" class="headerlink" title="所有网站皆可爬"></a>所有网站皆可爬</h2><p>互联网的内容都是人写出来的，而且都是偷懒写出来的（不会第一页是a，下一页是8），所以肯定有规律，这就给人有了爬取的可能，可以说，天下没有不能爬的网站</p>
<h2 id="框架不变"><a href="#框架不变" class="headerlink" title="框架不变"></a>框架不变</h2><p>网站不同，但是原理都类似，大部分爬虫都是从 发送请求——获得页面——解析页面——下载内容——储存内容 这样的流程来进行，只是用的工具不同</p>
<h1 id="基础相关"><a href="#基础相关" class="headerlink" title="基础相关"></a>基础相关</h1><h2 id="python-基础"><a href="#python-基础" class="headerlink" title="python 基础"></a>python 基础</h2><p>list，dict：用来序列化你爬的东西<br>切片：用来对爬取的内容进行分割，生成<br>条件判断（if等）：用来解决爬虫过程中哪些要哪些不要的问题<br>循环和迭代（for while ）：用来循环，重复爬虫动作<br>文件读写操作：用来读取参数、保存爬下来的内容等</p>
<h2 id="网页基本知识"><a href="#网页基本知识" class="headerlink" title="网页基本知识"></a>网页基本知识</h2><p>基本的HTML语言知识（知道href等大学计算机一级内容即可）<br>理解网站的发包和收包的概念（POST GET）<br>稍微一点点的js知识，用于理解动态网页（当然如果本身就懂当然更好啦）</p>
<h2 id="分析语言相关"><a href="#分析语言相关" class="headerlink" title="分析语言相关"></a>分析语言相关</h2><h3 id="正则表达式：扛把子技术，总得会最基础的"><a href="#正则表达式：扛把子技术，总得会最基础的" class="headerlink" title="正则表达式：扛把子技术，总得会最基础的"></a>正则表达式：扛把子技术，总得会最基础的</h3><p><img src="/images/爬虫相关/正则.jpg" alt="正则表达式"></p>
<h3 id="xpath：高效的分析语言，表达清晰简单，掌握了以后基本可以不用正则"><a href="#xpath：高效的分析语言，表达清晰简单，掌握了以后基本可以不用正则" class="headerlink" title="xpath：高效的分析语言，表达清晰简单，掌握了以后基本可以不用正则"></a><a href="http://www.w3school.com.cn/xpath/" target="_blank" rel="noopener">xpath</a>：高效的分析语言，表达清晰简单，掌握了以后基本可以不用正则</h3><h3 id="BeautifulSoup：美丽汤模块解析网页神器-一款神器，如果不用一些爬虫框架（如后文讲到的scrapy），配合request，urllib等模块（后面会详细讲），可以编写各种小巧精干的爬虫脚本"><a href="#BeautifulSoup：美丽汤模块解析网页神器-一款神器，如果不用一些爬虫框架（如后文讲到的scrapy），配合request，urllib等模块（后面会详细讲），可以编写各种小巧精干的爬虫脚本" class="headerlink" title="BeautifulSoup：美丽汤模块解析网页神器,一款神器，如果不用一些爬虫框架（如后文讲到的scrapy），配合request，urllib等模块（后面会详细讲），可以编写各种小巧精干的爬虫脚本"></a><a href="http://beautifulsoup.readthedocs.io/zh_CN/latest/" target="_blank" rel="noopener">BeautifulSoup</a>：美丽汤模块解析网页神器,一款神器，如果不用一些爬虫框架（如后文讲到的scrapy），配合request，urllib等模块（后面会详细讲），可以编写各种小巧精干的爬虫脚本</h3><h2 id="辅助工具相关"><a href="#辅助工具相关" class="headerlink" title="辅助工具相关"></a>辅助工具相关</h2><h3 id="F12开发者工具"><a href="#F12开发者工具" class="headerlink" title="F12开发者工具"></a>F12开发者工具</h3><ol>
<li>看源代码：快速定位元素</li>
<li>分析xpath：1、此处建议谷歌系浏览器,可以在源码界面直接右键看</li>
</ol>
<h3 id="抓包工具"><a href="#抓包工具" class="headerlink" title="抓包工具"></a>抓包工具</h3><p>推荐httpfox，火狐浏览器下的插件,比谷歌火狐系自带的F12工具都要好，可以方便查看网站收包发包的信息</p>
<h3 id="XPATH-CHECKER-火狐插件）"><a href="#XPATH-CHECKER-火狐插件）" class="headerlink" title="XPATH CHECKER (火狐插件）"></a>XPATH CHECKER (火狐插件）</h3><p>非常不错的xpath测试工具，但是有几个坑，都是个人踩过的，，在此告诫大家：     1、xpath checker生成的是绝对路径，遇到一些动态生成的图标（常见的有列表翻页按钮等），飘忽不定的绝对路径很有可能造成错误，所以这里建议在真正分析的时候，只是作为参考     2、记得把如下图xpath框里的“x:”去掉，貌似这个是早期版本xpath的语法，目前已经和一些模块不兼容（比如scrapy），还是删去避免报错</p>
<h3 id="正则表达式测试工具"><a href="#正则表达式测试工具" class="headerlink" title="正则表达式测试工具"></a>正则表达式测试工具</h3><p><a href="http://tool.oschina.net/regex/" target="_blank" rel="noopener">在线正则表达式测试</a><br>拿来多练练手，也辅助分析！里面有很多现成的正则表达式可以用，也可以进行参考！</p>
<h2 id="爬虫模块相关"><a href="#爬虫模块相关" class="headerlink" title="爬虫模块相关"></a>爬虫模块相关</h2><p>urllib urllib2 requests </p>
<h3 id="现成模块-scrapy"><a href="#现成模块-scrapy" class="headerlink" title="现成模块 scrapy"></a>现成模块 scrapy</h3><h3 id="动态页面解决-selenium-phantomJS"><a href="#动态页面解决-selenium-phantomJS" class="headerlink" title="动态页面解决 selenium phantomJS"></a>动态页面解决 selenium phantomJS</h3><h3 id="反爬虫策略验证码"><a href="#反爬虫策略验证码" class="headerlink" title="反爬虫策略验证码"></a>反爬虫策略验证码</h3><p>PIL opencv pybrain 打码平台</p>
<h2 id="数据库相关"><a href="#数据库相关" class="headerlink" title="数据库相关"></a>数据库相关</h2><p>mysql， mongodb， sqlite</p>
<h2 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h2><p>numpy 数据分析，类似matlab的模块<br>pandas（基于numpy的数据分析模块，相信我，如果你不是专门搞TB级数据的，这个就够了）</p>
<h2 id="技术进阶"><a href="#技术进阶" class="headerlink" title="技术进阶"></a>技术进阶</h2><p>多线程、分布式</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/21/“rxjava2-0”/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sample">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记录者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/21/“rxjava2-0”/" itemprop="url">“rxjava2.0”</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-21T16:24:02+08:00">
                2017-12-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/21/“rxjava2-0”/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/21/“rxjava2-0”/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#<a href="http://blog.csdn.net/flybasker/article/details/78703295" target="_blank" rel="noopener">Rxjava2.0</a></p>
<h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><p>Observable：在观察者模式中称为“被观察者”；<br>Observer：观察者模式中的“观察者”，可接收Observable发送的数据；<br>subscribe：订阅，观察者与被观察者，通过Observable的subscribe()方法进行订阅；<br>Subscriber：也是一种观察者，在2.0中 它与Observer没什么实质的区别，不同的是 Subscriber要与Flowable(也是一种被观察者)联合使用，该部分 内容是2.0新增的，后续文章再介绍。Obsesrver用于订阅Observable，而Subscriber用于订阅Flowable.</p>
<h2 id="Rxjava中定义的事件方法"><a href="#Rxjava中定义的事件方法" class="headerlink" title="Rxjava中定义的事件方法"></a>Rxjava中定义的事件方法</h2><p>onNext(),普通事件,按照队列依次进行处理.<br>onComplete(),事件队列完结时调用该方法<br>onError(),事件处理过程中出现异常时，onError()触发，同时队列终止,不再有事件发出.<br>onSubscribe(),RxJava 2.0 中新增的，传递参数为Disposable,可用于切断接收事件让Observable (被观察者)开启子线程执行耗操作，完成耗时操作后，触发回调，通知Observer (观察者)进行主线程UI更新</p>
<h2 id="observable的几种创建方式"><a href="#observable的几种创建方式" class="headerlink" title="observable的几种创建方式"></a>observable的几种创建方式</h2><ol>
<li><p>just()方式<br>使用just( )，将创建一个Observable并自动调用onNext( )发射数据。<br>也就是通过just( )方式 直接触发onNext()，just中传递的参数将直接在Observer的onNext()方法中接收到。</p>
</li>
<li><p>fromIterable()方式<br>使用fromIterable()，遍历集合，发送每个item.多次自动调用onNext()方法，每次传入一个item.<br>注意：Collection接口是Iterable接口的子接口，所以所有Collection接口的实现类都可以作为Iterable对象直接传入fromIterable()    方法。</p>
</li>
<li><p>defer()方式<br>当观察者订阅时,才创建Observable，并且针对每个观察者创建都是一个新的Observable.<br>通过Callable中的回调方法call(),决定使用以何种方式来创建这个Observable对象,当订阅后，发送事件.</p>
</li>
<li><p>interval( )方式<br>创建一个按固定时间间隔发射整数序列的Observable，可用作定时器。按照固定时间间隔来调用onNext()方法。</p>
</li>
<li><p>timer( )方式<br>通过此种创建一个Observable,它在一个给定的延迟后发射一个特殊的值，即表示延迟指定时间后，调用onNext()方法。</p>
</li>
<li><p>range( )方式,range(x,y)<br>创建一个发射特定整数序列的Observable，第一个参数x为起始值，第二个y为发送的个数，如果y为0则不发送，y为负数则抛异常。<br>range(1,5)<br>上述表示发射1到5的数。即调用5次Next()方法，依次传入1-5数字。</p>
</li>
<li><p>repeat( )方式<br>创建一个Observable，该Observable的事件可以重复调用。</p>
</li>
</ol>
<h2 id="ObservableEmitter"><a href="#ObservableEmitter" class="headerlink" title="ObservableEmitter"></a>ObservableEmitter</h2><p>Emitter是发射器的意思,就是用来发出事件的，它可以发出三种类型的事件<br>通过调用onNext(T value),发出next事件<br>通过调用onComplete(),发出complete事件<br>通过调用onError(Throwable error),发出error事件<br>注意事项:<br>onComplete和onError唯一并且互斥<br>发送多个onComplete, 第一个onComplete接收到,就不再接收了.<br>发送多个onError, 则收到第二个onError事件会导致程序会崩溃.<br>不可以随意乱七八糟发射事件，需要满足一定的规则：<br>上游可以发送无限个onNext, 下游也可以接收无限个onNext.<br>当上游发送了一个onComplete后, 上游onComplete之后的事件将会继续发送, 而下游收到onComplete事件之后将不再继续接收事件.<br>上游发送了一个onError后, 上游onError之后的事件将继续发送, 而下游收到onError事件之后将不再继续接收事件.<br>上游可以不发送onComplete或onError.<br>最为关键的是onComplete和onError必须唯一并且互斥, 即不能发多个onComplete, 也不能发多个onError, 也不能先发一个onComplete, 然后再发一个onError </p>
<h2 id="Disposable"><a href="#Disposable" class="headerlink" title="Disposable"></a>Disposable</h2><p>一次性,它理解成两根管道之间的一个机关, 当调用它的dispose()方法时, 它就会将两根管道切断, 从而导致下游收不到事件.<br>在RxJava中,用它来切断Observer(观察者)与Observable(被观察者)之间的连接，当调用它的dispose()方法时, 它就会将Observer(观察者)与Observable(被观察者)之间的连接切断, 从而导致Observer(观察者)收不到事件。<br>注意: 调用dispose()并不会导致上游不再继续发送事件, 上游会继续发送剩余的事件 </p>
<h2 id="线程调度"><a href="#线程调度" class="headerlink" title="线程调度"></a>线程调度</h2><ol>
<li><p>Schedulers.immediate():<br>直接在当前线程运行，相当于不指定线程。这是默认的Scheduler。</p>
</li>
<li><p>Schedulers.newThread():<br>总是启用新线程，并在新线程执行操作。</p>
</li>
<li><p>Schedulers.io(): I/O<br>操作（读写文件、读写数据库、网络信息交互等）所使用的Scheduler。行为模式和newThread()差不多，区别在于io()的内部实现是是用一个无数量上限的线程池，可以重用空闲的线程，因此多数情况下io()比newThread()更有效率。不要把计算工作放在io()中，可以避免创建不必要的线程。</p>
</li>
<li><p>Schedulers.computation():<br>计算所使用的Scheduler。这个计算指的是 CPU 密集型计算，即不会被 I/O 等操作限制性能的操作，例如图形的计算。这个Scheduler使用的固定的线程池，大小为 CPU 核数。不要把 I/O 操作放在computation()中，否则 I/O 操作的等待时间会浪费 CPU。</p>
</li>
<li><p>AndroidSchedulers.mainThread()，<br>Android专用线程，指定操作在主线程运行。</p>
</li>
</ol>
<p>如何切换线程呢？RxJava中提供了两个方法：<br>    subscribeOn() 和 observeOn() ，<br>两者的不同点在于：</p>
<p>subscribeOn(): 指定subscribe()订阅所发生的线程，或者叫做事件产生的线程。</p>
<p>observeOn(): 指定Observer所运行在的线程，即onNext()执行的线程。或者叫做事件消费的线程。</p>
<h2 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h2><p>操作符就是用于在Observable和最终的Observer之间，通过转换Observable为其他观察者对象的过程，修改发出的事件,最终将最简洁的数据传递给Observer对象. </p>
<ol>
<li><p>map()操作符，就是把原来的Observable对象转换成另一个Observable对象，同时将传输的数据进行一些灵活的操作，方便Observer获得想要的数据形式。<br>举例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable&lt;Integer&gt; observable = Observable</span><br><span class="line">        .just(&quot;hello&quot;)</span><br><span class="line">        .map(new Function&lt;String, Integer&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public Integer apply(String s) throws Exception &#123;</span><br><span class="line">                return s.length();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>flatMap()操作符<br>flatMap()对于数据的转换比map()更加彻底，如果发送的数据是集合，flatmap()重新生成一个Observable对象，并把数据转换成Observer想 要的数据形式。它可以返回任何它想返回的Observable对象。<br>举例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(list)</span><br><span class="line">       .flatMap(new Function&lt;List&lt;String&gt;, ObservableSource&lt;?&gt;&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public ObservableSource&lt;?&gt; apply(List&lt;String&gt; strings) throws Exception &#123;</span><br><span class="line">                return Observable.fromIterable(strings);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>filter()操作符<br>filter()操作符根据它的test()方法中，根据自己想过滤的数据加入相应的逻辑判断，返回true则表示数据满足条件，返回false则表示数据需要被过滤。最后过滤出的数据将加入到新的Observable对象中，方便传递给Observer想要的数据形式。<br>举例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Observable</span><br><span class="line">        .just(list)</span><br><span class="line">        .flatMap(new Function&lt;List&lt;String&gt;, ObservableSource&lt;?&gt;&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public ObservableSource&lt;?&gt; apply(List&lt;String&gt; strings) throws Exception &#123;</span><br><span class="line">                return Observable.fromIterable(strings);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).filter(new Predicate&lt;Object&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean test(Object s) throws Exception &#123;</span><br><span class="line">                String newStr = (String) s;</span><br><span class="line">                if (newStr.charAt(5) - &apos;0&apos; &gt; 5) &#123;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).subscribe(new Consumer&lt;Object&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void accept(Object o) throws Exception &#123;</span><br><span class="line">                System.out.println((String)o);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>take()操作符<br>输出最多指定数量的结果.(接收指定数量的结果)<br>举例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(new ArrayList&lt;String&gt;()&#123;</span><br><span class="line">            &#123;</span><br><span class="line">                for (int i = 0; i &lt; 8; i++) &#123;</span><br><span class="line">                    add(&quot;data&quot;+i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).flatMap(new Function&lt;List&lt;String&gt;, ObservableSource&lt;?&gt;&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public ObservableSource&lt;?&gt; apply(List&lt;String&gt; strings) throws Exception &#123;</span><br><span class="line">                return Observable.fromIterable(strings);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).take(5).subscribe(new Consumer&lt;Object&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void accept(Object s) throws Exception &#123;</span><br><span class="line">                DemonstrateUtil.showLogResult(s.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>doOnNext()操作符<br>允许我们在每次输出一个元素之前做一些额外的事情<br>举例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(new ArrayList&lt;String&gt;()&#123;</span><br><span class="line">            &#123;</span><br><span class="line">                for (int i = 0; i &lt; 6; i++) &#123;</span><br><span class="line">                    add(&quot;data&quot;+i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).flatMap(new Function&lt;List&lt;String&gt;, ObservableSource&lt;?&gt;&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public ObservableSource&lt;?&gt; apply(List&lt;String&gt; strings) throws Exception &#123;</span><br><span class="line">                return Observable.fromIterable(strings);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).take(5).doOnNext(new Consumer&lt;Object&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void accept(Object o) throws Exception &#123;</span><br><span class="line">                DemonstrateUtil.showLogResult(&quot;额外的准备工作!&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).subscribe(new Consumer&lt;Object&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void accept(Object s) throws Exception &#123;</span><br><span class="line">                DemonstrateUtil.showLogResult(s.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Flowable的理解"><a href="#Flowable的理解" class="headerlink" title="Flowable的理解"></a>Flowable的理解</h2><p>Flowable是一个被观察者，与Subscriber(观察者)配合使用，解决Backpressure问题<br>Backpressure(背压)。所谓背压，即生产者的速度大于消费者的速度带来的问题。</p>
<blockquote>
<p>什么情况下才会产生Backpressure问题？<br>1.如果生产者和消费者在一个线程的情况下，无论生产者的生产速度有多快，每生产一个事件都会通知消费者，等待消费者消费完毕，再生产下一个事件。<br>所以在这种情况下，根本不存在Backpressure问题。即同步情况下，Backpressure问题不存在。<br>2.如果生产者和消费者不在同一线程的情况下，如果生产者的速度大于消费者的速度，就会产生Backpressure问题。<br>即异步情况下，Backpressure问题才会存在。</p>
</blockquote>
<p>现象演示说明:<br>被观察者是事件的生产者,观察者是事件的消费者.假如生产者无限生成事件,而消费者以很缓慢的节奏来消费事件,会造成事件无限堆积,形成背压,最后造成OOM!<br>Flowable悠然而生，专门用来处理这类问题。<br>Flowable是为了应对Backpressure而产生的。Flowable是一个被观察者，<br>与Subscriber(观察者)配合使用，解决Backpressure问题。<br>注意：处理Backpressure的策略仅仅是处理Subscriber接收事件的方式，并不影响Flowable发送事件的方法。<br>即使采用了处理Backpressure的策略，Flowable原来以什么样的速度产生事件，现在还是什么样的速度不会变化，主要处理的是Subscriber接收事件的方式。</p>
<p>处理Backpressure问题的策略,或者来解决Backpressure问题</p>
<pre><code>BackpressureStrategy.ERROR
如果缓存池溢出,就会立刻抛出MissingBackpressureException异常
request()用来向生产者申请可以消费的事件数量,这样我们便可以根据本身的消费能力进行消费事件.
虽然并不限制向request()方法中传入任意数字，但是如果消费者并没有这么多的消费能力，依旧会造成资源浪费，最后产生OOM
at java.lang.OutOfMemoryError.&lt;init&gt;(OutOfMemoryError.java:33)
在异步调用时，RxJava中有个缓存池，用来缓存消费者处理不了暂时缓存下来的数据，缓存池的默认大小为128，即只能缓存128个事件。
无论request()中传入的数字比128大或小，缓存池中在刚开始都会存入128个事件。
当然如果本身并没有这么多事件需要发送，则不会存128个事件。
应用举例:


BackpressureStrategy.BUFFER
是把RxJava中默认的只能存128个事件的缓存池换成一个大的缓存池,支持存更多的数据.
消费者通过request()即使传入一个很大的数字，生产者也会生产事件,并将处理不了的事件缓存.
注意:
这种方式任然比较消耗内存，除非是我们比较了解消费者的消费能力，能够把握具体情况，不会产生OOM。
BUFFER要慎用

BackpressureStrategy.DROP
顾名思义,当消费者处理不了事件，就丢弃!
例如,当数据源创建了200个事件,先不进行消费临时进行缓存实际缓存128个,我们第一次申请消费了100个,再次申请消费100个,
那么实际只消费了128个,而其余的72个被丢弃了!

BackpressureStrategy.LATEST
LATEST与DROP功能基本一致,当消费者处理不了事件，就丢弃!
唯一的区别就是LATEST总能使消费者能够接收到生产者产生的最后一个事件。
例如,当数据源创建了200个事件,先不进行消费临时进行缓存,我们第一次申请消费了100个,再次申请消费100个,
那么实际只消费了129个,而其余的71个被丢弃了,但是第200个(最后一个)会被消费.


BackpressureStrategy.MISSING
生产的事件没有进行缓存和丢弃,下游接收到的事件必须进行消费或者处理!
</code></pre><p>在RxJava中会经常遇到一种情况就是被观察者发送消息十分迅速以至于观察者不能及时的响应这些消息<br>举例:<br>Observable.create(new ObservableOnSubscribe<integer>() {<br>        @Override<br>        public void subscribe(ObservableEmitter<integer> e) throws Exception {<br>            while (true){<br>                e.onNext(1);<br>            }<br>        }<br>    })<br>            .subscribeOn(Schedulers.io())<br>            .observeOn(AndroidSchedulers.mainThread())<br>            .subscribe(new Consumer<integer>() {<br>        @Override<br>        public void accept(Integer integer) throws Exception {<br>            Thread.sleep(2000);<br>            System.out.println(integer);<br>        }<br>    });<br>    被观察者是事件的生产者，观察者是事件的消费者。上述例子中可以看出生产者无限生成事件，而消费者每2秒才能消费一个事件，这会造成事件无限堆积，最后造成OOM。<br>Flowable就是由此产生，专门用来处理这类问题</integer></integer></integer></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/21/retrofit2-post/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sample">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记录者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/21/retrofit2-post/" itemprop="url">retrofit2 post</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-21T15:53:25+08:00">
                2017-12-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/21/retrofit2-post/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/21/retrofit2-post/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="retrofit的post方法"><a href="#retrofit的post方法" class="headerlink" title="retrofit的post方法"></a>retrofit的post方法</h1><h2 id="简单的双参数上传，结果是ResponseBody"><a href="#简单的双参数上传，结果是ResponseBody" class="headerlink" title="简单的双参数上传，结果是ResponseBody"></a>简单的双参数上传，结果是ResponseBody</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@FormUrlEncoded</span><br><span class="line">@POST(&quot;xxx.com&quot;)</span><br><span class="line">Observable&lt;ResponseBody&gt; login(</span><br><span class="line">	@Field(&quot;no&quot;) String no,</span><br><span class="line">	@Field(&quot;pass&quot;) String pass);</span><br></pre></td></tr></table></figure>
<h2 id="文件上传-（-多文件上传-使用-PartMap-Map-params-要注意在设置每一个RequestBody文件的时候，数组名不能一致，否则会覆-盖。）"><a href="#文件上传-（-多文件上传-使用-PartMap-Map-params-要注意在设置每一个RequestBody文件的时候，数组名不能一致，否则会覆-盖。）" class="headerlink" title="文件上传 （ 多文件上传,使用 @PartMap Map params 要注意在设置每一个RequestBody文件的时候，数组名不能一致，否则会覆 盖。）"></a>文件上传 （ 多文件上传,使用 @PartMap Map<string, requestbody=""> params 要注意在设置每一个RequestBody文件的时候，数组名不能一致，否则会覆 盖。）</string,></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Multipart</span><br><span class="line">   @POST(&quot;xxx.com&quot;)</span><br><span class="line">   Observable&lt;ResponseBody&gt; uploadFile(</span><br><span class="line">       @Part(&quot;file\&quot;; filename=\&quot;test.png&quot;) RequestBody file</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>
<h2 id="单文件上传"><a href="#单文件上传" class="headerlink" title="单文件上传"></a>单文件上传</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Multipart</span><br><span class="line">   @POST(&quot;xxx.com&quot;)</span><br><span class="line">   Observable&lt;ResponseBody&gt; uploadFile(</span><br><span class="line">           @Part MultipartBody.Part file );</span><br></pre></td></tr></table></figure>
<h2 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a>多文件上传</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Multipart</span><br><span class="line">   @POST(&quot;xxx.com&quot;)</span><br><span class="line">   Observable&lt;ResponseBody&gt; uploadFile(</span><br><span class="line">           @Part() List&lt;MultipartBody.Part&gt; files );</span><br></pre></td></tr></table></figure>
<h2 id="文件和参数共同上传-参数也需要封装成MultipartBody-Part这样的类型，不然传递会出错，这个类型其实就是将这些数据封装成表单的类型，因为在这里不能使用FormUrlEncoded进行处理"><a href="#文件和参数共同上传-参数也需要封装成MultipartBody-Part这样的类型，不然传递会出错，这个类型其实就是将这些数据封装成表单的类型，因为在这里不能使用FormUrlEncoded进行处理" class="headerlink" title="文件和参数共同上传  (参数也需要封装成MultipartBody.Part这样的类型，不然传递会出错，这个类型其实就是将这些数据封装成表单的类型，因为在这里不能使用FormUrlEncoded进行处理)"></a>文件和参数共同上传  (参数也需要封装成MultipartBody.Part这样的类型，不然传递会出错，这个类型其实就是将这些数据封装成表单的类型，因为在这里不能使用FormUrlEncoded进行处理)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Multipart</span><br><span class="line">   @POST(&quot;xxx.com&quot;)</span><br><span class="line">   Observable&lt;ResponseBody&gt; uploadFile(</span><br><span class="line">        @Part() List&lt;MultipartBody.Part &gt; files );</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Sample</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">42</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sample</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://Mr.Sample.disqus.com/count.js" async></script>
    

    

  




	





  












  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'lyLXiEg3TqshvM3qxHjYskBX-gzGzoHsz',
        appKey: 'SlOO9nVu3kxycc3RxicJUlXA',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
