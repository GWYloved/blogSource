---
title: "Android虚拟机编译策略"
date: 2019-05-13T14:55:16+08:00
draft: false
---

# 虚拟机的作用

虚拟机通过将代码翻译为二进制，起了一个解释器的作用。

其完整的步骤大致如下：

一个.java文件，通过javac编译为后缀为.class的字节码文件，然后虚拟机通过对应的机器接口，一边解释这个字节码文件为二进制，一边运行。

其解释运行的步骤如下：

解释执行（AOT）：将编译好的字节码一行一行地翻译为机器码执行。

通过解释执行消除了平台差异性。

但事实上还有一种执行方法：

编译执行（JIT）：以方法为单位，将字节码一次性翻译为机器码后执行。

解释执行的好处类似于饿汉，编译执行就是懒汉。前者优势在于不用等待，后者优势在于效率更高

# Dalvik虚拟机

主要罗列一下与普通jvm不同的地方

## jvm虚拟机运行的是java字节码，dalvik运行的是dalvik字节码

dalvik字节码其实就是java字节码转换而来并且打包到一个dex可执行文件中

## dalvik可执行文件体积更小

为了减小运行文件的体积，安卓使用Dalvik虚拟机，SDK中有个dx工具负责将JAVA字节码转换为Dalvik字节码。dx工具对JAVA类文件又一次排列，将全部JAVA类文件里的常量池分解，消除当中的冗余信息。又一次组合形成一个常量池。全部的类文件共享同一个常量池。使得相同的字符串、常量在DEX文件里仅仅出现一次，从而减小了文件的体积。

## jvm基于栈，dalvik基于寄存器

因此一定程度上代码指令集降低，增加了速度

# ART虚拟机

